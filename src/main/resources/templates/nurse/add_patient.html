<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    <head th:replace="fragments/layout :: head_fragment (pageTitle='Add new patient')"/>
    <body>
        <div th:replace="fragments/header :: header"/>

        <div class="container">

            <div class="card orange darken hoverable">
                <div class="card-content white-text">
                    <div class="card-title">
                        <span th:text="#{new_patient}">New Patient</span>                     
                    </div>
                </div>
            </div>

            <div id="errorMessage" class="card-panel red lighten-2" th:if="${patient_id_exists}">
                <span class="card-title" th:text="#{patient_id_exists}">Patient id exists</span>
            </div>
            <form action="#" th:action="@{/nurse/new_patient}" th:object="${patient}" method="post">

                <div class="row">
                    <div class="input-field col s12 m4 l2">
                        <input id="id" type="text" class="validate" required="true"
                               th:field="*{id}"/>
                        <label for="id" th:text="#{patient_id}">Patient UID</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 m4 ">
                        <input id="first_name" type="text" class="validate" required="true"
                               th:field="*{firstName}"/>
                        <label for="first_name" th:text="#{first_name}" >First Name</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="middle_name" type="text" class="validate"
                               th:field="*{middleName}"/>
                        <label for="middle_name" th:text="#{middle_name}">Middle Name</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="last_name" type="text" class="validate" required="true"
                               th:field="*{lastName}"/>
                        <label for="last_name" th:text="#{last_name}">Last Name</label>
                    </div>
                </div>

                <div class="row">

                    <div class="input-field col s12 m4">
                        <input id="dob" type="date"
                               th:field="*{dateOfBirth}" required="true"/>

                    </div>

                    <div class="input-field col s6 m4">
                        <select th:field="*{gender}">
                            <option value="MALE" th:text="#{gender_male}">Male</option>
                            <option value="FEMALE" th:text="#{gender_female}">Female</option>
                        </select>

                    </div>

                    <div class="input-field col s6 m4">
                        <select th:field="*{bloodType}">
                            <option value="UNDETERMINED" th:text="#{blood_type.undetermined}">Undetermined</option>
                            <option value="A_POSITIVE" th:text="#{blood_type.a_pos}">A positive</option>
                            <option value="A_NEGATIVE" th:text="#{blood_type.a_neg}">A negative</option>
                            <option value="B_POSITIVE" th:text="#{blood_type.b_pos}">B positive</option>
                            <option value="B_NEGATIVE" th:text="#{blood_type.b_neg}">B negative</option>
                            <option value="AB_POSITIVE" th:text="#{blood_type.ab_pos}">AB positive</option>
                            <option value="AB_NEGATIVE" th:text="#{blood_type.ab_neg}">AB negative</option>
                            <option value="O_POSITIVE" th:text="#{blood_type.o_pos}">O positive</option>
                            <option value="O_NEGATIVE" th:text="#{blood_type.o_neg}">O negative</option>
                        </select>

                    </div>

                </div>

                <div class="row">
                    <div class="input-field col s12 m6">
                        <input id="phone_number" type="text" class="validate" pattern="^\d{3}-\d{3}-\d{4}$"
                               th:field="*{phone}"/>
                        <label for="phone_number" th:text="#{phone}">Phone Number</label>
                    </div>
                    <div class="input-field col s12 m6">
                        <input id="email" type="email" class="validate"
                               th:field="*{email}"/>
                        <label for="email"  th:text="#{email}">Email</label>
                    </div>


                </div>
                <div class="row">
                    <div class="input-field col s12 m6">
                        <input id="address" type="text" class="validate" required="true"
                               th:field="*{address}"/>
                        <label for="address"  th:text="#{address}">Address</label>
                    </div>
                    <div class="input-field col s12 m6">
                        <input id="city" type="text" class="validate" required="true"
                               th:field="*{city}"/>
                        <label for="city"  th:text="#{city}">Address</label>
                    </div>
                </div>


                <div class="row center">
                    <button class="btn waves-effect waves-light" type="submit" name="action" th:text="#{save}">Submit
                        <i class="material-icons right">save</i>
                    </button>
                </div>
            </form>


        </div>

        <div th:replace="fragments/footer :: footer"/>

        <script type="text/javascript">

            $(document).ready(function () {

                $('select').material_select();

                $('.datepicker').pickadate({
                    selectMonths: true, // Creates a dropdown to control month
                    selectYears: 100, // Creates a dropdown of 15 years to control year,
                    formatSubmit: 'yyyy-MM-dd',
                    today: 'Today',
                    clear: 'Clear',
                    close: 'Ok',
                    max: true,
                    closeOnSelect: true // Close upon selecting a date,
                            // editable: true
                });

                // the "href" attribute of the modal trigger must specify the modal ID that wants to be triggered
                $('.modal').modal();


            });

            function checkDate() {
                if ($('#dob').val() == '') {
                    $('#dob').addClass('invalid')
                    return false;
                } else {
                    $('#dob').removeClass('invalid')
                    return true;
                }
            }

            $('form').submit(function () {
                if (!checkDate()) {
                    return false;
                }

            });

            $('#dob').change(function () {
                checkDate();
            });

            form.validate({
                rules: {
                    phone_number: {required: true,
                        matches: "^(\\d|\\s)+$",
                        minlength: 10,
                        maxlength: 20}
                }
            });

        </script>
    </body>
</html>

